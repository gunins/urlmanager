!function(t,n){"function"==typeof define&&define.amd?define("router/MatchBinding",n):"object"==typeof exports?module.exports=n():(t.UrlManager=t.UrlManager||{},t.UrlManager.MatchBinding=n())}(this,function(){function t(n,e){""===e?this.pattern=e=n.replace(/^\(\/\)/g,"").replace(/^\/|$/g,""):(this.pattern=n,e+=n),this.location=e.replace(/\((.*?)\)/g,"$1").replace(/^\/|$/g,"");var r=this.pattern.replace(t.ESCAPE_PARAM,"\\$&").replace(t.OPTIONAL_PARAM,"(?:$1)?").replace(t.NAMED_PARAM,function(t,n){return n?t:"([^/]+)"}).replace(t.SPLAT_PARAM,"(.*?)");this.patternRegExp=new RegExp("^"+r),this.routeHandler=[],this.leaveHandler=[],this.queryHandler=[],this.routes=[]}return t.prototype.onBind=function(){},t.prototype.setOnBind=function(t){this.onBind=t},t.prototype.rebind=function(){void 0!==this.onBind&&this.onBind()},t.prototype.setRoutes=function(t){return this.routes.push(t),this},t.prototype.getRoutes=function(){return this.routes},t.prototype.to=function(t){return this.routeHandler.push(t),this},t.prototype.leave=function(t){return this.leaveHandler.push(t),this},t.prototype.query=function(t){return this.queryHandler.push(t),this},t.prototype.remove=function(){return this.routes.splice(0,this.routes.length),this.routeHandler.splice(0,this.routeHandler.length),this.leaveHandler.splice(0,this.leaveHandler.length),this.queryHandler.splice(0,this.queryHandler.length),this},t.prototype.test=function(t){return this.patternRegExp.test(t)},t.prototype.getFragment=function(t){var n=this.applyParams(t);return t.replace(n,"")},t.prototype.applyParams=function(t){var n=this.pattern.replace(/\((.*?)\)/g,"$1").split("/"),e=t.split("/");return e.splice(0,n.length).join("/")},t.prototype.extractParams=function(t){var n=this.patternRegExp.exec(t).slice(1);return n.map(function(t){return t?decodeURIComponent(t):null})},t.prototype.setSubBinder=function(t){return this.subBinder=t,t},t.prototype.getSubBinder=function(){return this.subBinder},t.prototype.getHandler=function(){return this.routeHandler},t.prototype.getLeaveHandler=function(){return this.leaveHandler},t.prototype.getQueryHandler=function(){return this.queryHandler},t.OPTIONAL_PARAM=/\((.*?)\)/g,t.NAMED_PARAM=/(\(\?)?:\w+/g,t.SPLAT_PARAM=/\*\w+/g,t.ESCAPE_PARAM=/[\-{}\[\]+?.,\\\^$|#\s]/g,t}),function(t,n){"function"==typeof define&&define.amd?define("router/MatchBinder",["./MatchBinding"],n):"object"==typeof exports?module.exports=n(require("./MatchBinding")):(t.UrlManager=t.UrlManager||{},t.UrlManager.MatchBinder=n(t.UrlManager.MatchBinding))}(this,function(t){function n(t,n,e,r){this.bindings=[],this.location=r||t||"",this.command=e,this.params=n}return n.prototype.match=function(t,n){"function"==typeof t&&(n=t,t=!1),""===t&&(t=!1);var e=this.getMatchBinding(t,this.location);this.bindings.push(e);var r=t?this.getSubBinder(this.location+(t||"")):this;return e.setSubBinder(r),n&&n(r.match.bind(r)),e},n.prototype.getSubBinder=function(t){return new n(t)},n.prototype.getMatchBinding=function(n,e){return new t(n,e)},n.prototype.filter=function(t){return this.bindings.filter(function(n){return n.test(t)})},n.prototype.run=function(){this.command(this)},n}),function(t,n){"function"==typeof define&&define.amd?define("router/Router",["./MatchBinder"],n):"object"==typeof exports?module.exports=n(require("./MatchBinder")):(t.UrlManager=t.UrlManager||{},t.UrlManager.Router=n(t.UrlManager.MatchBinder))}(this,function(t){function n(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(n){return t}}function e(t,n){var e=t.split("&");e.forEach(function(t){var e=t.split("=");n(e.shift(),e.join("="))})}function r(t,n,e,r){var i,o=e.root.substring(0,e.root.length-r.length);return t=t||"",i=n===!0?this.serialize(e.query):n===!1?"":this.serialize(n),o+t+(0===i.length?"":"?"+i)}function i(){this.root=this.getBinder(),this.bindings=[]}return Array.prototype.equals=function(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var n=0,e=this.length;e>n;n++)if(this[n]instanceof Array&&t[n]instanceof Array){if(!this[n].equals(t[n]))return!1}else if(this[n]!=t[n])return!1;return!0},i.prototype.getBinder=function(){return new t},i.prototype.match=function(t){t(this.root.match.bind(this.root))},i.prototype.trigger=function(t){if(this.started){var r=t.split("?",2),i={};r[1]&&e(r[1],function(t,e){e=n(e),i[t]?"string"==typeof i[t]?i[t]=[i[t],e]:i[t].push(e):i[t]=e});var o=r[0].replace(/^\/|$/g,""),s={root:o,query:i},a=[],p=!1;this.bindings.forEach(function(n){var e,r=n.pattern.replace(/\((.*?)\)/g,"$1").replace(/^\//,"").split("/"),i=n.location.split("/"),u=n.prevLoc.replace(/^\//,"").split("/"),h=function(t){var n=t.splice(i.length-r.length,r.length),e=u.splice(0,r.length);return!n.equals(e)};if(e=h(p||o.split("/"))){p=o.split("/").splice(0,i.length-r.length);var c=n.getLeaveHandler(),l=[];n.setOnBind(),this.applyHandler(c,l,s,t),a.push(n)}}.bind(this)),a.forEach(function(t){this.bindings.splice(this.bindings.indexOf(t),1)}.bind(this)),this.find(this.root,o,s)}},i.prototype.find=function(t,n,e){var r=t.filter(n);r.forEach(this.onBinding.bind(this,n,e))},i.prototype.execute=function(t){var n=t.location.split("/"),e=t.params.root.split("/"),r="/"+e.splice(n.length,e.length-n.length).join("/");this.find(t,r,t.params)},i.prototype.onBinding=function(n,e,r){r.setOnBind(this.onBinding.bind(this,n,e,r)),this.runHandler(n,e,r);var i=r.getFragment(n),o=r.getSubBinder();o&&o.bindings&&o.bindings.length>0&&this.find(o,i,e);var s=r.getRoutes();if(s&&s.length>0)for(;s.length>0;){var a=s[0],p=new t(r.getFragment(n),e,this.execute.bind(this),r.location);a(p),o.bindings=o.bindings.concat(p.bindings),s.shift()}},i.prototype.serialize=function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return n.join("&")},i.prototype.runHandler=function(t,n,e){if(-1===this.bindings.indexOf(e)){var r=e.getHandler(),i=e.extractParams(t);e.prevLoc=t,this.applyHandler(r,i,n,t),this.bindings.push(e)}var r=e.getQueryHandler();r&&this.applyHandler(r,[],n,t)},i.prototype.applyHandler=function(t,n,e,i){t&&t.length>0&&t.forEach(function(t){t.apply(this,n.concat({getQuery:function(){return e.query},getLocation:function(t,n){return r.call(this,t,n,e,i)}.bind(this)}))}.bind(this))},i.prototype.start=function(){this.started=!0},i.prototype.stop=function(){this.started=!1},i});