!function(e,t){"function"==typeof define&&define.amd?define("router/utils",[],t):"object"==typeof exports&&(module.exports=t())}(0,function(){"use strict";function e(e){let t=[];for(let r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}const t=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,r=/(?:^|,)\s*([^\s,=]+)/g;return{serialize:e,getLocation:function(t,r){return{getQuery:()=>t.query,getLocation(i="",n){let s;return t.root.substring(0,t.root.length-r.length)+i+(0===(s=!0===n?e(t.query):!1===n?"":e(n)).length?"":"?"+s)}}},equals:function e(t,r){if(!r)return!1;if(t.length!==r.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]instanceof Array&&r[i]instanceof Array){if(!e(t[i],r[i]))return!1}else if(t[i]!==r[i])return!1;return!0},setQuery:function(e){let t={};var r;return e&&(r=((e,r)=>{r=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}}(r),t[e]?"string"==typeof t[e]?t[e]=[t[e],r]:t[e].push(r):t[e]=r}),e.split("&").forEach(e=>{let t=e.split("=");r(t.shift(),t.join("="))})),t},getArgs:function(e){let i=(...e)=>(t,r)=>e.map(e=>t.indexOf(e)).filter(e=>e===r).length>0,n=e.toString().replace(t,""),s=i("(","function (","function(")(n,0)?n.indexOf("(")+1:0,a=i("=>")(n,-1)?n.indexOf(")"):n.indexOf("=>"),o=n.slice(s,a).trim().match(r);return null===o?[]:o.map(e=>e.replace(/[\s,]/g,""))}}}),function(e,t){"function"==typeof define&&define.amd?define("router/MatchBinding",["./utils"],t):"object"==typeof exports&&(module.exports=t(require("./utils")))}(0,function(e){"use strict";class t{constructor(e,r,i){if(i&&(this.binder=i),""===r)this.pattern=e.replace(/^\(\/\)/g,"").replace(/^\/|$/g,"");else{null===e.match(/^(\/|\(\/)/g)&&(e="("===e[0]?"(/"+e.substring(1):"/"+e),this.pattern=e}let n=this.pattern.replace(t.ESCAPE_PARAM,"\\$&").replace(t.OPTIONAL_PARAM,"(?:$1)?").replace(t.NAMED_PARAM,function(e,t){return t?e:"([^/]+)"}).replace(t.SPLAT_PARAM,"(.*)");this.patternRegExp=new RegExp("^"+n),this.routeHandler=new Set,this.leaveHandler=new Set,this.queryHandler=new Set,this._active=!1}setRoutes(e){var t=this.subBinder;return e({match:t.match.bind(t)}),this}reTrigger(){this.binder.reTrigger()}match(e){var t=this.subBinder;return e(t.match.bind(t)),this}to(e){return this.routeHandler.add({handler:e,done:!1}),this.reTrigger(),this}leave(t){var r=e.getArgs(t);return this.leaveHandler.add({handler:t,done:r.length>0&&"done"===r[0]}),this}query(e){return this.queryHandler.add({handler:e,done:!1}),this}remove(){return this.routeHandler.clear(),this.leaveHandler.clear(),this.queryHandler.clear(),this.subBinder.remove(),this}test(e){return this.patternRegExp.test(e)}getFragment(e){let t=e.match(this.patternRegExp);return null===t?"":e.substring(t[0].length)}extractParams(e){let t=this.patternRegExp.exec(e);return t&&t.length>0?t.slice(1).map(function(e){return e?decodeURIComponent(e):null}):[]}setSubBinder(e,t,r){let i=new e(t,this);return this.subBinder=i,"function"==typeof r&&r(i.match.bind(i)),i}checkSegment(t,r){let i=[];if(this._active){let n=this.pattern.replace(/\((.*?)\)/g,"$1").replace(/^\//,"").split("/"),s=this.prevLoc.replace(/^\//,"").split("/"),a=t.slice(0,n.length),o=s.slice(0,n.length),h=e.equals(a,o);h?t.length>1?i=this.subBinder.checkStatus(t.slice(n.length),r):h&&(i=this.subBinder.clearActive(r)):i=this.clearActive(r)}return i}clearActive(e){let t=[];return this._active&&t.push({handler:this.triggerLeave(e),disable:this.disable.bind(this)}),t.concat(this.subBinder.clearActive())}disable(){this._active=!1}triggerTo(t,r){if(this.test(t)){if(!this._active){this.prevLoc=t;let i=this.extractParams(t).concat(e.getLocation(r,t));this.applyHandlers(this.routeHandler,i),this._active=!0}this.applyHandlers(this.queryHandler,[e.getLocation(r,t)]);let i=this.getFragment(t);if(""!==i.trim()){let e=this.subBinder;e&&e.triggerRoutes(i,r)}}}applyHandlers(e,t=[]){e&&e.size>0&&e.forEach(e=>{e.handler.apply(this,t)})}triggerLeave(t){return new Promise(r=>{let i=this.leaveHandler,n=e.getLocation(t,this.prevLoc),s=0,a=!1;i&&i.size>0&&i.forEach(e=>{e.done&&s++,e.handler((e=!0)=>{e?0!==--s||a||r(!0):e||a||(a=!0,r(!1))},n)}),0===s&&r(!0)})}}return Object.assign(t,{OPTIONAL_PARAM:/\((.*?)\)/g,NAMED_PARAM:/(\(\?)?:\w+/g,SPLAT_PARAM:/\*\w+/g,ESCAPE_PARAM:/[\-{}\[\]+?.,\\\^$|#\s]/g}),t}),function(e,t){"function"==typeof define&&define.amd?define("router/MatchBinder",["./MatchBinding"],t):"object"==typeof exports?module.exports=t(require("./MatchBinding")):(e.UrlManager=e.UrlManager||{},e.UrlManager.MatchBinder=t(e.UrlManager.MatchBinding))}(this,function(e){"use strict";class t{constructor(e,t){this._parent=t,this.bindings=new Set,this.location=e||"",this._active=!1}reTrigger(){this._parent.reTrigger()}match(e,t){return"function"==typeof e&&(t=e,e=!1),""===e&&(e=!1),this.getMatchBinding(e,t)}getMatchBinding(r,i){if(r){let n=new e(r,this.location,this);return n.setSubBinder(t,this.location+(r||""),i),this.bindings.add(n),n}return"function"==typeof i&&i(this.match.bind(this)),{match:this.match.bind(this)}}clearActive(e,t){let r=[];return this.bindings.size>0&&this.bindings.forEach(i=>{r=r.concat(i.clearActive(e,t))}),r}checkStatus(e,t){let r=[];return this.bindings.size>0&&this.bindings.forEach(i=>{r=r.concat(i.checkSegment(e,t))}),r}remove(){this.bindings.size>0&&this.bindings.forEach(e=>e.remove())}triggerRoutes(e,t){this.bindings.size>0&&this.bindings.forEach(r=>r.triggerTo(e,t))}}return t}),function(e,t){"function"==typeof define&&define.amd?define("router/Router",["./MatchBinder","./utils"],t):"object"==typeof exports&&(module.exports=t(require("./MatchBinder"),require("./utils")))}(0,function(e,t){"use strict";return class{constructor(e){void 0!==e&&""!==e&&(this._location=e.replace(/^\/|\/$/g,"")+"/"),this.root=this.getBinder(),this._listeners=new Set,this._handlers=new Set}getBinder(){return new e("",this)}test(e){return new RegExp("^"+this._location,"g").test(e)}getLocation(e){let t=e.replace(/^\/|$/g,"");return void 0!==this._location?!!this.test(t)&&t.replace(this._location,""):t}reTrigger(){this.currLocation&&this.trigger(this.currLocation)}trigger(e){if(this.started){this.currLocation=e;let r=e.split("?",2),i=this.getLocation(r[0]);if(i||""===i){let e=t.setQuery(r[1]),n={root:i,query:e};this.execute(i,n).then(e=>this.setRoutes(e,i,n)).then(e=>this.setLocation(e))}}}execute(e,t){return new Promise(r=>{let i=e.replace(/^\/|$/g,"").split("/"),n=this.root.checkStatus(i,t);n.length>0?n.forEach(e=>{e.handler.then(t=>{e.triggered||(e.triggered=!0,e.applied=t,n.filter(e=>e.applied).length===n.length?(n.forEach(e=>e.disable()),r(!0)):n.filter(e=>e.triggered).length===n.length&&r(!1))})}):r(!0)})}setRoutes(e,t,r){return e&&(this._handlers.forEach(e=>e()),this.root.triggerRoutes(t,r)),e}setListener(e){let t=this._listeners;return t.add(e),{remove(){t.delete(e)}}}onRouteChange(e){let t=this._handlers;return t.add(e),{remove(){t.delete(e)}}}setLocation(e){let t=e?this.currLocation:this.prevLocation;this.prevLocation=t,this._listeners.forEach(r=>r(t,e))}match(e){e(this.root.match.bind(this.root))}start(){this.started=!0}stop(){this.started=!1}}});