!function(t,n){"function"==typeof define&&define.amd?define("router/utils",[],n):"object"==typeof exports&&(module.exports=n())}(0,function(){"use strict";function t(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(n){return t}}function n(t,n){t.split("&").forEach(t=>{let e=t.split("=");n(e.shift(),e.join("="))})}function e(e){let i={};return e&&n(e,(n,e)=>{e=t(e),i[n]?"string"==typeof i[n]?i[n]=[i[n],e]:i[n].push(e):i[n]=e}),i}function i(t){let n=[];for(let e in t)t.hasOwnProperty(e)&&n.push(encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return n.join("&")}function r(t,n){return{getQuery(){return t.query},getLocation(e="",r){let o,s=t.root.substring(0,t.root.length-n.length);return o=r===!0?i(t.query):r===!1?"":i(r),s+e+(0===o.length?"":"?"+o)}}}function o(t,n){if(!n)return!1;if(t.length!==n.length)return!1;for(let e=0,i=t.length;e<i;e++)if(t[e]instanceof Array&&n[e]instanceof Array){if(!o(t[e],n[e]))return!1}else if(t[e]!==n[e])return!1;return!0}function s(t){let n=t.toString().replace(c,""),e=n.slice(n.indexOf("(")+1,n.indexOf(")")),i=e.match(u);return null===i?[]:i.map(t=>t.replace(/[\s,]/g,""))}const c=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,u=/(?:^|,)\s*([^\s,=]+)/g;return{serialize:i,getLocation:r,equals:o,setQuery:e,getArgs:s}}),function(t,n){"function"==typeof define&&define.amd?define("router/MatchBinding",["./utils"],n):"object"==typeof exports&&(module.exports=n(require("./utils")))}(0,function(t){"use strict";class n{constructor(t,e,i){if(i&&(this.binder=i),""===e)this.pattern=t.replace(/^\(\/\)/g,"").replace(/^\/|$/g,"");else{let n=t.match(/^(\/|\(\/)/g);null===n&&(t="("===t[0]?"(/"+t.substring(1):"/"+t),this.pattern=t}let r=this.pattern.replace(n.ESCAPE_PARAM,"\\$&").replace(n.OPTIONAL_PARAM,"(?:$1)?").replace(n.NAMED_PARAM,function(t,n){return n?t:"([^/]+)"}).replace(n.SPLAT_PARAM,"(.*)");this.patternRegExp=new RegExp("^"+r),this.routeHandler=new Set,this.leaveHandler=new Set,this.queryHandler=new Set,this._active=!1}setRoutes(t){var n=this.subBinder;return t({match:n.match.bind(n)}),this}reTrigger(){this.binder.reTrigger()}match(t){var n=this.subBinder;return t(n.match.bind(n)),this}to(t){return this.routeHandler.add({handler:t,done:!1}),this.reTrigger(),this}leave(n){var e=t.getArgs(n);return this.leaveHandler.add({handler:n,done:e.length>0&&"done"===e[0]}),this}query(t){return this.queryHandler.add({handler:t,done:!1}),this}remove(){return this.routeHandler.clear(),this.leaveHandler.clear(),this.queryHandler.clear(),this.subBinder.remove(),this}test(t){return this.patternRegExp.test(t)}getFragment(t){let n=t.match(this.patternRegExp);return null===n?"":t.substring(n[0].length)}extractParams(t){let n=this.patternRegExp.exec(t);return n&&n.length>0?n.slice(1).map(function(t){return t?decodeURIComponent(t):null}):[]}setSubBinder(t,n,e){let i=new t(n,this);return this.subBinder=i,"function"==typeof e&&e(i.match.bind(i)),i}checkSegment(n,e){let i=[];if(this._active){let r=this.pattern.replace(/\((.*?)\)/g,"$1").replace(/^\//,"").split("/"),o=this.prevLoc.replace(/^\//,"").split("/"),s=n.slice(0,r.length),c=o.slice(0,r.length),u=t.equals(s,c);u?n.length>1?i=this.subBinder.checkStatus(n.slice(r.length),e):u&&(i=this.subBinder.clearActive(e)):i=this.clearActive(e)}return i}clearActive(t){let n=[];return this._active&&n.push({handler:this.triggerLeave(t),disable:this.disable.bind(this)}),n.concat(this.subBinder.clearActive())}disable(){this._active=!1}triggerTo(n,e){if(this.test(n)){if(!this._active){this.prevLoc=n;let i=this.extractParams(n).concat(t.getLocation(e,n));this.applyHandlers(this.routeHandler,i),this._active=!0}this.applyHandlers(this.queryHandler,[t.getLocation(e,n)]);let i=this.getFragment(n);if(""!==i.trim()){let t=this.subBinder;t&&t.triggerRoutes(i,e)}}}applyHandlers(t,n=[]){t&&t.size>0&&t.forEach(t=>{t.handler.apply(this,n)})}triggerLeave(n){return new Promise(e=>{let i=this.leaveHandler,r=t.getLocation(n,this.prevLoc),o=0,s=!1;i&&i.size>0&&i.forEach(t=>{t.done&&o++,t.handler((t=!0)=>{t?0!==--o||s||e(!0):t||s||(s=!0,e(!1))},r)}),0===o&&e(!0)})}}return Object.assign(n,{OPTIONAL_PARAM:/\((.*?)\)/g,NAMED_PARAM:/(\(\?)?:\w+/g,SPLAT_PARAM:/\*\w+/g,ESCAPE_PARAM:/[\-{}\[\]+?.,\\\^$|#\s]/g}),n}),function(t,n){"function"==typeof define&&define.amd?define("router/MatchBinder",["./MatchBinding"],n):"object"==typeof exports?module.exports=n(require("./MatchBinding")):(t.UrlManager=t.UrlManager||{},t.UrlManager.MatchBinder=n(t.UrlManager.MatchBinding))}(this,function(t){"use strict";class n{constructor(t,n){this._parent=n,this.bindings=new Set,this.location=t||"",this._active=!1}reTrigger(){this._parent.reTrigger()}match(t,n){return"function"==typeof t&&(n=t,t=!1),""===t&&(t=!1),this.getMatchBinding(t,n)}getMatchBinding(e,i){if(e){let r=new t(e,this.location,this);return r.setSubBinder(n,this.location+(e||""),i),this.bindings.add(r),r}return"function"==typeof i&&i(this.match.bind(this)),{match:this.match.bind(this)}}clearActive(t,n){let e=[];return this.bindings.size>0&&this.bindings.forEach(i=>{e=e.concat(i.clearActive(t,n))}),e}checkStatus(t,n){let e=[];return this.bindings.size>0&&this.bindings.forEach(i=>{e=e.concat(i.checkSegment(t,n))}),e}remove(){this.bindings.size>0&&this.bindings.forEach(t=>t.remove())}triggerRoutes(t,n){this.bindings.size>0&&this.bindings.forEach(e=>e.triggerTo(t,n))}}return n}),function(t,n){"function"==typeof define&&define.amd?define("router/Router",["./MatchBinder","./utils"],n):"object"==typeof exports&&(module.exports=n(require("./MatchBinder"),require("./utils")))}(0,function(t,n){"use strict";class e{constructor(t){void 0!==t&&""!==t&&(this._location=t.replace(/^\/|\/$/g,"")+"/"),this.root=this.getBinder(),this._listeners=new Set,this._handlers=new Set}getBinder(){return new t("",this)}test(t){return new RegExp("^"+this._location,"g").test(t)}getLocation(t){let n=t.replace(/^\/|$/g,"");return void 0!==this._location?!!this.test(n)&&n.replace(this._location,""):n}reTrigger(){this.currLocation&&this.trigger(this.currLocation)}trigger(t){if(this.started){this.currLocation=t;let e=t.split("?",2),i=this.getLocation(e[0]);if(i||""===i){let t=n.setQuery(e[1]),r={root:i,query:t};this.execute(i,r).then(t=>this.setRoutes(t,i,r)).then(t=>this.setLocation(t))}}}execute(t,n){return new Promise(e=>{let i=t.replace(/^\/|$/g,"").split("/"),r=this.root,o=r.checkStatus(i,n);o.length>0?o.forEach(t=>{t.handler.then(n=>{t.triggered||(t.triggered=!0,t.applied=n,o.filter(t=>t.applied).length===o.length?(o.forEach(t=>t.disable()),e(!0)):o.filter(t=>t.triggered).length===o.length&&e(!1))})}):e(!0)})}setRoutes(t,n,e){return t&&(this._handlers.forEach(t=>t()),this.root.triggerRoutes(n,e)),t}setListener(t){let n=this._listeners;return n.add(t),{remove(){n.delete(t)}}}onRouteChange(t){let n=this._handlers;return n.add(t),{remove(){n.delete(t)}}}setLocation(t){let n=t?this.currLocation:this.prevLocation;this.prevLocation=n,this._listeners.forEach(e=>e(n,t))}match(t){t(this.root.match.bind(this.root))}start(){this.started=!0}stop(){this.started=!1}}return e});