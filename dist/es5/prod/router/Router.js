/*! urlmanager 2016-04-07 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};!function(a,b){"function"==typeof define&&define.amd?define("router/utils",[],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b())}(void 0,function(){function a(a){try{return decodeURIComponent(a.replace(/\+/g," "))}catch(b){return a}}function b(a,b){var c=a.split("&");c.forEach(function(a){var c=a.split("=");b(c.shift(),c.join("="))})}function c(c){var d={};return c&&b(c,function(b,c){c=a(c),d[b]?"string"==typeof d[b]?d[b]=[d[b],c]:d[b].push(c):d[b]=c}),d}function d(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function e(a,b){return{getQuery:function(){return a.query},getLocation:function(){var c=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments[1],f=a.root.substring(0,a.root.length-b.length),g=void 0;return g=e===!0?d(a.query):e===!1?"":d(e),f+c+(0===g.length?"":"?"+g)}}}function f(a,b){if(!b)return!1;if(a.length!==b.length)return!1;for(var c=0,d=a.length;d>c;c++)if(a[c]instanceof Array&&b[c]instanceof Array){if(!f(a[c],b[c]))return!1}else if(a[c]!==b[c])return!1;return!0}function g(a){var b=a.toString().replace(h,""),c=b.slice(b.indexOf("(")+1,b.indexOf(")")),d=c.match(i);return null===d?[]:d.map(function(a){return a.replace(/[\s,]/g,"")})}var h=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,i=/(?:^|,)\s*([^\s,=]+)/g;return{serialize:d,getLocation:e,equals:f,setQuery:c,getArgs:g}}),function(a,b){"function"==typeof define&&define.amd?define("router/MatchBinding",["./utils"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./utils")))}(void 0,function(a){var b=function(){function b(a,c,d){_classCallCheck(this,b),d&&(this._binder=d),""===c?this.pattern=a.replace(/^\(\/\)/g,"").replace(/^\/|$/g,""):this.pattern=a;var e=this.pattern.replace(b.ESCAPE_PARAM,"\\$&").replace(b.OPTIONAL_PARAM,"(?:$1)?").replace(b.NAMED_PARAM,function(a,b){return b?a:"([^/]+)"}).replace(b.SPLAT_PARAM,"(.*?)");this.patternRegExp=new RegExp("^"+e),this.routeHandler=[],this.leaveHandler=[],this.queryHandler=[],this.routes=[],this._active=!1}return _createClass(b,[{key:"onBind",value:function(){}},{key:"setOnBind",value:function(a){this.onBind=a}},{key:"rebind",value:function(){void 0!==this.onBind&&this.onBind()}},{key:"setRoutes",value:function(a){return this.routes.push(a),this}},{key:"getRoutes",value:function(){return this.routes}},{key:"match",value:function(a){var b=this.getSubBinder();return a(b.match.bind(b)),this}},{key:"to",value:function(a){return this.routeHandler.push({handler:a,done:!1}),this}},{key:"leave",value:function(b){var c=a.getArgs(b);return this.leaveHandler.push({handler:b,done:c.length>0&&"done"===c[0]}),this}},{key:"query",value:function(a){return this.queryHandler.push({handler:a,done:!1}),this}},{key:"remove",value:function(){return this.routes.splice(0,this.routes.length),this.routeHandler.splice(0,this.routeHandler.length),this.leaveHandler.splice(0,this.leaveHandler.length),this.queryHandler.splice(0,this.queryHandler.length),this}},{key:"test",value:function(a){return this.patternRegExp.test(a)}},{key:"getFragment",value:function(a){var b=this.applyParams(a);return a.replace(b,"")}},{key:"applyParams",value:function(a){var b=this.pattern.replace(/\((.*?)\)/g,"$1").split("/"),c=a.split("/");return c.splice(0,b.length).join("/")}},{key:"extractParams",value:function(a){var b=this.patternRegExp.exec(a);return b&&b.length>0?b.slice(1).map(function(a){return a?decodeURIComponent(a):null}):[]}},{key:"setSubBinder",value:function(a,b,c){var d=new a(b);return this.subBinder=d,"function"==typeof c&&c(d.match.bind(d)),d}},{key:"getSubBinder",value:function(){return this.subBinder}},{key:"getHandler",value:function(){return this.routeHandler}},{key:"getLeaveHandler",value:function(){return this.leaveHandler}},{key:"getQueryHandler",value:function(){return this.queryHandler}},{key:"getHandlers",value:function(a){var b={to:"getHandler",leave:"getLeaveHandler",query:"getQueryHandler"};return this[b[a]]()}},{key:"checkSegment",value:function(b,c){var d=[];if(this._active){var e=this.pattern.replace(/\((.*?)\)/g,"$1").replace(/^\//,"").split("/"),f=this.prevLoc.replace(/^\//,"").split("/"),g=b.slice(0,e.length),h=f.slice(0,e.length),i=a.equals(g,h);i?b.length>1?d=this.getSubBinder().checkStatus(b.slice(e.length),c):i&&(d=this.getSubBinder().clearActive(c)):d=this.clearActive(c)}return d}},{key:"clearActive",value:function(a){var b=[];return this._active&&(b.push(this.triggerLeave(a)),this._active=!1),b.concat(this.getSubBinder().clearActive())}},{key:"triggerTo",value:function(a,b){if(this.test(a)){this._active||(this.trigger("to",b,a),this._active=!0),this.trigger("query",b,a);var c=this.getFragment(a);if(""!==c.trim()){var d=this.getSubBinder();d&&d.bindings&&d.bindings.length>0&&d.trigger(c,b)}}}},{key:"triggerLeave",value:function(b){var c=this;return function(d){var e=c.getLeaveHandler(),f=a.getLocation(b,c.prevLoc),g=0,h=!1;e.forEach(function(a){a.done&&g++;var b=function(){var a=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];a?(g--,0!==g||h||d(!0)):a||h||(h=!0),h&&d(!1)};a.handler(b,f)}),0===g&&d(!0)}}},{key:"trigger",value:function(b,c,d){"to"===b&&(this.prevLoc=d);var e=this.extractParams(d).concat(a.getLocation(c,d)),f=this.getHandlers(b);this.applyHandlers(f,e)}},{key:"applyHandlers",value:function(a){var b=this,c=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];a&&a.length>0&&a.forEach(function(a){a.handler.apply(b,c)})}}]),b}();return Object.assign(b,{OPTIONAL_PARAM:/\((.*?)\)/g,NAMED_PARAM:/(\(\?)?:\w+/g,SPLAT_PARAM:/\*\w+/g,ESCAPE_PARAM:/[\-{}\[\]+?.,\\\^$|#\s]/g}),b}),function(a,b){"function"==typeof define&&define.amd?define("router/MatchBinder",["./MatchBinding"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=b(require("./MatchBinding")):(a.UrlManager=a.UrlManager||{},a.UrlManager.MatchBinder=b(a.UrlManager.MatchBinding))}(void 0,function(a){var b=function(){function b(a,c,d){_classCallCheck(this,b),this.bindings=[],this._activeBindings=[],this.location=a||"",this.command=d,this.params=c,this._active=!1}return _createClass(b,[{key:"match",value:function(a,b){return"function"==typeof a&&(b=a,a=!1),""===a&&(a=!1),this.getMatchBinding(a,b)}},{key:"getMatchBinding",value:function(c,d){if(c){var e=new a(c,this.location,this);return e.setSubBinder(b,this.location+(c||""),d),this.bindings.push(e),e}return"function"==typeof d&&d(this.match.bind(this)),{match:this.match.bind(this)}}},{key:"clearActive",value:function(a,b){var c=[];return this.bindings.length>0&&this.bindings.forEach(function(d){c=c.concat(d.clearActive(a,b))}),c}},{key:"checkStatus",value:function(a,b){var c=[];return this.bindings.length>0&&this.bindings.forEach(function(d){c=c.concat(d.checkSegment(a,b))}),c}},{key:"trigger",value:function(a,b,c){var d=this,e=a.replace(/^\/|$/g,"").split("/"),f=this.checkStatus(e,b);f.length>0?!function(){var e=0;f.forEach(function(g){g(function(g){g?e++:c&&c(!1),f.length===e&&(d.triggerRoutes(a,b),c&&c(!0))})})}():(this.triggerRoutes(a,b),c&&c(!0))}},{key:"triggerRoutes",value:function(a,b){this.bindings.forEach(function(c){return c.triggerTo(a,b)})}},{key:"run",value:function(){this.command(this)}}]),b}();return b}),function(a,b){"function"==typeof define&&define.amd?define("router/Router",["./MatchBinder","./utils"],b):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=b(require("./MatchBinder"),require("./utils")))}(void 0,function(a,b){var c=function(){function c(a){_classCallCheck(this,c),void 0!==a&&""!==a&&(this._location=a.replace(/^\/|\/$/g,"")+"/"),this.root=this.getBinder(),this._listeners=new Set}return _createClass(c,[{key:"getBinder",value:function(){return new a}},{key:"test",value:function(a){return new RegExp("^"+this._location,"g").test(a)}},{key:"getLocation",value:function(a){var b=a.replace(/^\/|$/g,"");return void 0!==this._location?this.test(b)?b.replace(this._location,""):!1:b}},{key:"trigger",value:function(a){var c=this;if(this.started){this.started=!1;var d=a.split("?",2),e=this.getLocation(d[0]);if(e){var f=b.setQuery(d[1]),g={root:e,query:f};this.root.trigger(e,g,function(b){c.setLocation(b?a:c.prevLocation),c.prevLocation=a,c.started=!0})}}}},{key:"setListener",value:function(a){var b=this._listeners;return b.add(a),{remove:function(){b["delete"](a)}}}},{key:"setLocation",value:function(a){this._listeners.forEach(function(b){return b(a)})}},{key:"match",value:function(a){a(this.root.match.bind(this.root))}},{key:"start",value:function(){this.started=!0}},{key:"stop",value:function(){this.started=!1}}]),c}();return c});