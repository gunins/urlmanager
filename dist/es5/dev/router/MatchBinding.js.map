{"version":3,"sources":["../../../es6/dev/router/MatchBinding.js"],"names":[],"mappings":"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","file":"MatchBinding.js","sourcesContent":["(function(root, factory) {\n\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([\n            './utils'\n        ], factory);\n    } else if (typeof exports === 'object') {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('./utils'));\n    }\n}(this, function(utils) {\n    'use strict';\n\n\n    class MatchBinding {\n        constructor(pattern, location, binder) {\n            if (binder) {\n                this._binder = binder;\n            }\n            if (location === '') {\n                this.pattern = location = pattern.replace(/^\\(\\/\\)/g, '').replace(/^\\/|$/g, '');\n            } else {\n                this.pattern = pattern;\n                location = (location + pattern);\n            }\n            this.location = location.replace(/\\((.*?)\\)/g, '$1').replace(/^\\/|$/g, '');\n\n            let route = this.pattern.replace(MatchBinding.ESCAPE_PARAM, '\\\\$&')\n                .replace(MatchBinding.OPTIONAL_PARAM, '(?:$1)?')\n                .replace(MatchBinding.NAMED_PARAM, function(match, optional) {\n                    return optional ? match : '([^\\/]+)';\n                }).replace(MatchBinding.SPLAT_PARAM, '(.*?)');\n\n            this.patternRegExp = new RegExp('^' + route);\n\n            this.routeHandler = [];\n            this.leaveHandler = [];\n            this.queryHandler = [];\n            this.routes = [];\n        }\n\n        onBind() {\n        };\n\n        setOnBind(onBinding) {\n            this.onBind = onBinding\n        };\n\n        rebind() {\n            if (this.onBind !== undefined) {\n                this.onBind();\n            }\n        };\n\n        setRoutes(routes) {\n            this.routes.push(routes);\n            return this;\n        };\n\n        getRoutes() {\n            return this.routes;\n        };\n\n        match(match) {\n            var subBinder = this.getSubBinder();\n            match(subBinder.match.bind(subBinder))\n            return this;\n        };\n\n        to(routeHandler) {\n            this.routeHandler.push(routeHandler);\n            return this;\n        };\n\n        leave(leaveHandler) {\n            this.leaveHandler.push(leaveHandler);\n            return this;\n        };\n\n        query(queryHandler) {\n            this.queryHandler.push(queryHandler);\n            return this;\n        };\n\n        remove() {\n            this.routes.splice(0, this.routes.length);\n            this.routeHandler.splice(0, this.routeHandler.length);\n            this.leaveHandler.splice(0, this.leaveHandler.length);\n            this.queryHandler.splice(0, this.queryHandler.length);\n            return this;\n        };\n\n        test(location) {\n            return this.patternRegExp.test(location);\n        };\n\n        getFragment(location) {\n            let subLocation = this.applyParams(location);\n            return location.replace(subLocation, '');\n        };\n\n        applyParams(location) {\n            let matches = this.pattern.replace(/\\((.*?)\\)/g, '$1').split('/');\n            let matches2 = location.split('/');\n            return matches2.splice(0, matches.length).join('/');\n        };\n\n        extractParams(fragment) {\n            let params = this.patternRegExp.exec(fragment)\n            if (params && params.length > 0) {\n                return params.slice(1).map(function(param) {\n                    return param ? decodeURIComponent(param) : null;\n                });\n            } else {\n                return [];\n            }\n        };\n\n        setSubBinder(MatchBinder, pattern, mapHandler) {\n            let subBinder = new MatchBinder(pattern);\n            this.subBinder = subBinder;\n            if (mapHandler) {\n                mapHandler(subBinder.match.bind(subBinder));\n            }\n            return subBinder;\n        };\n\n        getSubBinder() {\n            return this.subBinder;\n        };\n\n        getHandler() {\n            return this.routeHandler;\n        };\n\n        getLeaveHandler() {\n            return this.leaveHandler;\n        };\n\n        getQueryHandler() {\n            return this.queryHandler;\n        };\n\n        getHandlers(name) {\n            let map = {\n                to: 'getHandler', leave: 'getLeaveHandler', query: 'getQueryHandler'\n            }\n            return this[map[name]]();\n        };\n\n        checkSegment(matched, params) {\n            let pattern = this.pattern.replace(/\\((.*?)\\)/g, '$1').replace(/^\\//, '').split('/'),\n                prevLoc = this.prevLoc.replace(/^\\//, '').split('/'),\n                currSegment = matched.slice(0, pattern.length),\n                prevSegment = prevLoc.slice(0, pattern.length),\n                equals = (utils.equals(currSegment, prevSegment));\n\n            if (!equals) {\n                this.clearActive(params);\n            } else if (matched.length > 1) {\n                this.getSubBinder().checkStatus(matched.slice(pattern.length), params);\n            } else {\n                this.getSubBinder().clearActive(params);\n            }\n\n            return equals;\n\n\n        }\n\n        clearActive(params, location) {\n            this.trigger('leave', params, location);\n            this.getSubBinder().clearActive();\n        }\n\n        trigger(name, params, location) {\n            if (name === 'to') {\n                this.prevLoc = location;\n            }\n            let args = this.extractParams(location),\n                handlers = this.getHandlers(name);\n\n            if (handlers && handlers.length > 0) {\n                handlers.forEach((handler)=> {\n                    handler.apply(this, args.concat(utils.getLocation(params)));\n                });\n            }\n        };\n    }\n    ;\n    Object.assign(MatchBinding, {\n        OPTIONAL_PARAM: /\\((.*?)\\)/g,\n        NAMED_PARAM:    /(\\(\\?)?:\\w+/g,\n        SPLAT_PARAM:    /\\*\\w+/g,\n        ESCAPE_PARAM:   /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g\n    });\n\n    return MatchBinding;\n}));"]}