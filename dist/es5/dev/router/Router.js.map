{"version":3,"sources":["../../../es6/dev/router/Router.js"],"names":[],"mappings":"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","file":"Router.js","sourcesContent":["/*globals define*/\n(function (root, factory) {\n\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([\n            './MatchBinder'\n        ], factory);\n    } else if (typeof exports === 'object') {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('./MatchBinder'));\n    } else {\n        // Browser globals (root is window)\n        root.UrlManager = root.UrlManager || {};\n        root.UrlManager.Router = factory(root.UrlManager.MatchBinder);\n    }\n}(this, function (MatchBinder) {\n    'use strict';\n\n    // attach the .equals method to Array's prototype to call it on any array\n    Array.prototype.equals = function (array) {\n        // if the other array is a falsy value, return\n        if (!array)\n            return false;\n        // compare lengths - can save a lot of time\n        if (this.length != array.length)\n            return false;\n\n        for (var i = 0, l = this.length; i < l; i++) {\n            // Check if we have nested arrays\n            if (this[i] instanceof Array && array[i] instanceof Array) {\n                // recurse into the nested arrays\n                if (!this[i].equals(array[i]))\n                    return false;\n            }\n            else if (this[i] != array[i]) {\n                // Warning - two different object instances will never be equal: {x:20} != {x:20}\n                return false;\n            }\n        }\n        return true;\n    };\n\n    function parseParams(value) {\n        try {\n            return decodeURIComponent(value.replace(/\\+/g, ' '));\n        }\n        catch (err) {\n            // Failover to whatever was passed if we get junk data\n            return value;\n        }\n    }\n\n    function iterateQueryString(queryString, callback) {\n        var keyValues = queryString.split('&');\n        keyValues.forEach(function (keyValue) {\n            var arr = keyValue.split('=');\n            callback(arr.shift(), arr.join('='));\n        });\n    }\n\n    function getLocation(fragment, isQuery, params, location) {\n        var current = params.root.substring(0, params.root.length - location.length), newQuery;\n        fragment = fragment || '';\n        if (isQuery === true) {\n            newQuery = this.serialize(params.query);\n        }\n        else if (isQuery === false) {\n            newQuery = '';\n        }\n        else {\n            newQuery = this.serialize(isQuery);\n        }\n        return current + fragment + (newQuery.length === 0 ? '' : '?' + newQuery);\n    }\n\n    function Router() {\n        this.root = this.getBinder();\n        this.bindings = [];\n    }\n\n    Router.prototype.getBinder = function () {\n        return new MatchBinder();\n    };\n    Router.prototype.match = function (mapHandler) {\n        mapHandler(this.root.match.bind(this.root));\n    };\n    Router.prototype.trigger = function (location) {\n        if (this.started) {\n            var parts = location.split('?', 2);\n            var query = {};\n            if (parts[1]) {\n                iterateQueryString(parts[1], function (name, value) {\n                    value = parseParams(value);\n                    if (!query[name]) {\n                        query[name] = value;\n                    }\n                    else if (typeof query[name] === 'string') {\n                        query[name] = [query[name], value];\n                    }\n                    else {\n                        query[name].push(value);\n                    }\n                });\n            }\n            var loc = parts[0].replace(/^\\/|$/g, ''),\n                params = {\n                    root: loc,\n                    query: query\n                },\n                notValid = [],\n                matched = false;\n\n            this.bindings.forEach(function (binder) {\n                var fragment,\n                    pattern = binder.pattern.replace(/\\((.*?)\\)/g, '$1').replace(/^\\//, '').split('/'),\n                    binderLocation = binder.location.split('/'),\n                    prevLoc = binder.prevLoc.replace(/^\\//, '').split('/'),\n                    checkSegment = function (link) {\n                        var currSegment = link.splice(binderLocation.length - pattern.length, pattern.length),\n                            prevSegment = prevLoc.splice(0, pattern.length);\n                        return (!currSegment.equals(prevSegment));\n                    };\n                fragment = checkSegment(matched || loc.split('/'));\n                if (fragment) {\n                    matched = loc.split('/').splice(0, binderLocation.length - pattern.length);\n                    var handler = binder.getLeaveHandler(),\n                        args = [];\n                    binder.setOnBind();\n\n                    this.applyHandler(handler, args, params, location);\n                    notValid.push(binder);\n                }\n            }.bind(this));\n\n            notValid.forEach(function (binder) {\n                this.bindings.splice(this.bindings.indexOf(binder), 1);\n            }.bind(this));\n\n            this.find(this.root, loc, params);\n        }\n    };\n    Router.prototype.find = function (binder, location, params) {\n        var bindings = binder.filter(location);\n        bindings.forEach(this.onBinding.bind(this, location, params));\n    };\n\n    Router.prototype.execute = function (binder) {\n        var binderlocation = binder.location.split('/'),\n            rootLocation = binder.params.root.split('/'),\n            location = '/' + rootLocation.splice(binderlocation.length, rootLocation.length -\n                                                                        binderlocation.length).join('/');\n        this.find(binder, location, binder.params);\n    };\n\n    Router.prototype.onBinding = function (location, params, binding) {\n        binding.setOnBind(this.onBinding.bind(this, location, params, binding))\n        this.runHandler(location, params, binding);\n        var fragment = binding.getFragment(location);\n        var subBinder = binding.getSubBinder();\n        if (subBinder && subBinder.bindings && subBinder.bindings.length > 0) {\n            this.find(subBinder, fragment, params);\n        }\n        var subRoutes = binding.getRoutes();\n        if (subRoutes && subRoutes.length > 0) {\n            while (subRoutes.length > 0) {\n                var Route = subRoutes[0],\n                    binder = new MatchBinder(binding.getFragment(location), params, this.execute.bind(this), binding.location);\n                Route(binder);\n                subBinder.bindings = subBinder.bindings.concat(binder.bindings);\n                subRoutes.shift();\n            }\n        }\n\n    };\n\n    Router.prototype.serialize = function (obj) {\n        var str = [];\n        for (var p in obj)\n            if (obj.hasOwnProperty(p)) {\n                str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\n            }\n        return str.join(\"&\");\n    };\n    Router.prototype.runHandler = function (location, params, binding) {\n\n        if (this.bindings.indexOf(binding) === -1) {\n            var handler = binding.getHandler();\n            var args = binding.extractParams(location);\n\n            binding.prevLoc = location;\n\n            this.applyHandler(handler, args, params, location);\n            this.bindings.push(binding);\n        }\n\n        var handler = binding.getQueryHandler();\n        if (handler) {\n            this.applyHandler(handler, [], params, location);\n        }\n\n    };\n    Router.prototype.applyHandler = function (handlers, args, params, location) {\n        if (handlers && handlers.length > 0) {\n            handlers.forEach(function (handler) {\n                handler.apply(this, args.concat({\n                    getQuery: function () {\n                        return params.query;\n                    },\n                    getLocation: function (fragment, isQuery) {\n                        return getLocation.call(this, fragment, isQuery, params, location)\n                    }.bind(this)\n                }));\n            }.bind(this));\n        }\n    };\n    Router.prototype.start = function () {\n        this.started = true;\n    };\n    Router.prototype.stop = function () {\n        this.started = false;\n    };\n\n    return Router;\n}));\n"]}